# Services

AngularJS services are substitutable objects that are wired together using dependency injection (DI). You can use services to organize and share code across your app.

- Lazily instantiated: only instantiates a service when an application component depends on it.
- Singletons: Each component dependent on a service gets a reference to the single instance generated by the service factory.

Like other core AngularJS identifiers, built-in services always start with $ (e.g. $http).

## Using a Service

```html
<div id="simple" ng-controller="MyController">
  <p>
    Let's try this simple notify service, injected into the controller...
  </p>
  <input ng-init="message='test'" ng-model="message" />
  <button ng-click="callNotify(message);">NOTIFY</button>
  <p>(you have to click 3 times to see an alert)</p>
</div>
```

```js
angular
  .module("app", [])
  .controller("MyController", [
    "$scope",
    "notify",
    function($scope, notify) {
      $scope.callNotify = function(msg) {
        notify(msg);
      };
    }
  ])
  .factory("notify", [
    "$window",
    function(win) {
      var msgs = [];
      return function(msg) {
        msgs.push(msg);
        if (msgs.length === 3) {
          win.alert(msgs.join("\n"));
          msgs = [];
        }
      };
    }
  ]);
```

## Creating Services

Application developers are free to define their own services by registering the service's name and service factory function, with an AngularJS module.

The service factory function generates the single object or function that represents the service to the rest of the application. The object or function returned by the service is injected into any component (controller, service, filter or directive) that specifies a dependency on the service.

Note that you are not registering a service instance, but rather a factory function that will create this instance when called.

Services can have their own dependencies.

```js
app.factory("factory2", [
  "factory1",
  function(factory1) {
    return {
      attr: function() {
        factory1("test");
      }
    };
  }
]);
```

## Unit Testing

Mocking a service's dependencies:

```js
angular.module("myModule", []).config([
  "$provide",
  function($provide) {
    $provide.factory("serviceId", function() {
      var shinyNewServiceInstance;
      // factory function body that constructs shinyNewServiceInstance
      return shinyNewServiceInstance;
    });
  }
]);
```

Mocking above notify service

```js
var mock, notify;
beforeEach(module("app"));
beforeEach(function() {
  mock = { alert: jasmine.createSpy() };

  module(function($provide) {
    $provide.value("$window", mock);
  });

  inject(function($injector) {
    notify = $injector.get("notify");
  });
});

it("should alert all after 3 notifications", function() {
  notify("1");
  notify("2");
  notify("3");

  expect(mock.alert).toHaveBeenCalledWith("1\n2\n3");
});

it("should clear messages after alert", function() {
  notify("1");
  notify("2");
  notify("3");

  expect(mock.alert.calls.count()).toEqual(2);
  expect(mock.alert.calls.mostRecent().args).toEqual(["1\n2\n3"]);
});
```
